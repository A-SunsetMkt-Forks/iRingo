class t{static name="Lodash";static version="1.2.2";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static get(t={},e="",s=void 0){Array.isArray(e)||(e=this.toPath(e));const a=e.reduce(((t,e)=>Object(t)[e]),t);return void 0===a?s:a}static set(t={},e="",s){return Array.isArray(e)||(e=this.toPath(e)),e.slice(0,-1).reduce(((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=/^\d+$/.test(e[a+1])?[]:{}),t)[e[e.length-1]]=s,t}static unset(t={},e=""){return Array.isArray(e)||(e=this.toPath(e)),e.reduce(((t,s,a)=>a===e.length-1?(delete t[s],!0):Object(t)[s]),t)}static toPath(t){return t.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static escape(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return t.replace(/[&<>"']/g,(t=>e[t]))}static unescape(t){const e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,(t=>e[t]))}}class e{static name="$Storage";static version="1.0.9";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static data=null;static dataFile="box.dat";static#t=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static#e(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}static getItem(e=new String,s=null){let a=s;if(!0===e.startsWith("@")){const{key:s,path:o}=e.match(this.#t)?.groups;e=s;let i=this.getItem(e,{});"object"!=typeof i&&(i={}),a=t.get(i,o);try{a=JSON.parse(a)}catch(t){}}else{switch(this.#e()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":a=$persistentStore.read(e);break;case"Quantumult X":a=$prefs.valueForKey(e);break;case"Node.js":this.data=this.#s(this.dataFile),a=this.data?.[e];break;default:a=this.data?.[e]||null}try{a=JSON.parse(a)}catch(t){}}return a??s}static setItem(e=new String,s=new String){let a=!1;if("object"==typeof s)s=JSON.stringify(s);else s=String(s);if(!0===e.startsWith("@")){const{key:o,path:i}=e.match(this.#t)?.groups;e=o;let n=this.getItem(e,{});"object"!=typeof n&&(n={}),t.set(n,i,s),a=this.setItem(e,n)}else switch(this.#e()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":a=$persistentStore.write(s,e);break;case"Quantumult X":a=$prefs.setValueForKey(s,e);break;case"Node.js":this.data=this.#s(this.dataFile),this.data[e]=s,this.#a(this.dataFile),a=!0;break;default:a=this.data?.[e]||null}return a}static removeItem(e){let s=!1;if(!0===e.startsWith("@")){const{key:a,path:o}=e.match(this.#t)?.groups;e=a;let i=this.getItem(e);"object"!=typeof i&&(i={}),keyValue=t.unset(i,o),s=this.setItem(e,i)}else switch(this.#e()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:s=!1;break;case"Quantumult X":s=$prefs.removeValueForKey(e)}return s}static clear(){let t=!1;switch(this.#e()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:t=!1;break;case"Quantumult X":t=$prefs.removeAllValues()}return t}static#s(t){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(t),s=this.path.resolve(process.cwd(),t),a=this.fs.existsSync(e),o=!a&&this.fs.existsSync(s);if(!a&&!o)return{};{const t=a?e:s;try{return JSON.parse(this.fs.readFileSync(t))}catch(t){return{}}}}}static#a(t=this.dataFile){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(t),s=this.path.resolve(process.cwd(),t),a=this.fs.existsSync(e),o=!a&&this.fs.existsSync(s),i=JSON.stringify(this.data);a?this.fs.writeFileSync(e,i):o?this.fs.writeFileSync(s,i):this.fs.writeFileSync(e,i)}}}class s{static name="ENV";static version="1.7.1";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}constructor(t,e){console.log(`\n🟧 ${s.name} v${s.version}\n`),this.name=t,this.logs=[],this.isMute=!1,this.isMuteLog=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log(`\n🚩 开始!\n${t}\n`)}platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}isNode(){return"Node.js"===this.platform()}isQuanX(){return"Quantumult X"===this.platform()}isSurge(){return"Surge"===this.platform()}isLoon(){return"Loon"===this.platform()}isShadowrocket(){return"Shadowrocket"===this.platform()}isStash(){return"Stash"===this.platform()}isEgern(){return"Egern"===this.platform()}async getScript(t){return await this.fetch(t).then((t=>t.body))}async runScript(t,s){let a=e.getItem("@chavy_boxjs_userCfgs.httpapi");a=a?.replace?.(/\n/g,"")?.trim();let o=e.getItem("@chavy_boxjs_userCfgs.httpapi_timeout");o=1*o??20,o=s?.timeout??o;const[i,n]=a.split("@"),r={url:`http://${n}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:o},headers:{"X-Key":i,Accept:"*/*"},timeout:o};await this.fetch(r).then((t=>t.body),(t=>this.logErr(t)))}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}async fetch(e={}||"",s={}){switch(e.constructor){case Object:e={...e,...s};break;case String:e={url:e,...s}}e.method||(e.method="GET",(e.body??e.bodyBytes)&&(e.method="POST")),delete e.headers?.["Content-Length"],delete e.headers?.["content-length"];const a=e.method.toLocaleLowerCase();switch(this.platform()){case"Loon":case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return delete e.id,e.policy&&(this.isLoon()&&(e.node=e.policy),this.isStash()&&t.set(e,"headers.X-Stash-Selected-Proxy",encodeURI(e.policy))),ArrayBuffer.isView(e.body)&&(e["binary-mode"]=!0),await new Promise(((t,s)=>{$httpClient[a](e,((a,o,i)=>{a?s(a):(o.ok=/^2\d\d$/.test(o.status),o.statusCode=o.status,i&&(o.body=i,1==e["binary-mode"]&&(o.bodyBytes=i)),t(o))}))}));case"Quantumult X":return e.policy&&t.set(e,"opts.policy",e.policy),delete e.charset,delete e.host,delete e.path,delete e.policy,delete e.scheme,delete e.sessionIndex,delete e.statusCode,e.body instanceof ArrayBuffer?(e.bodyBytes=e.body,delete e.body):ArrayBuffer.isView(e.body)?(e.bodyBytes=e.body.buffer.slice(e.body.byteOffset,e.body.byteLength+e.body.byteOffset),delete object.body):e.body&&delete e.bodyBytes,await $task.fetch(e).then((t=>(t.ok=/^2\d\d$/.test(t.statusCode),t.status=t.statusCode,t)),(t=>Promise.reject(t.error)));case"Node.js":let s=require("iconv-lite");this.initGotEnv(e);const{url:o,...i}=e;return await this.got[a](o,i).on("redirect",((t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}})).then((t=>(t.statusCode=t.status,t.body=s.decode(t.rawBody,this.encoding),t.bodyBytes=t.rawBody,t)),(t=>Promise.reject(t.message)))}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}msg(t=name,e="",s="",a){const o=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.platform()){case"Surge":case"Stash":case"Egern":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.platform()){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return{url:t.url||t.openUrl||t["open-url"]};case"Loon":return{openUrl:t.openUrl||t.url||t["open-url"],mediaUrl:t.mediaUrl||t["media-url"]};case"Quantumult X":return{"open-url":t["open-url"]||t.url||t.openUrl,"media-url":t["media-url"]||t.mediaUrl,"update-pasteboard":t["update-pasteboard"]||t.updatePasteboard};case"Node.js":return}default:return}};if(!this.isMute)switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":default:$notification.post(t,e,s,o(a));break;case"Quantumult X":$notify(t,e,s,o(a));case"Node.js":}if(!this.isMuteLog){let a=["","==============📣系统通知📣=============="];a.push(t),e&&a.push(e),s&&a.push(s),console.log(a.join("\n")),this.logs=this.logs.concat(a)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️ ${this.name}, 错误!`,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t.stack)}}wait(t){return new Promise((e=>setTimeout(e,t)))}done(e={}){const s=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🚩 ${this.name}, 结束! 🕛 ${s} 秒`,""),this.platform()){case"Surge":e.policy&&t.set(e,"headers.X-Surge-Policy",e.policy),$done(e);break;case"Loon":e.policy&&(e.node=e.policy),$done(e);break;case"Stash":e.policy&&t.set(e,"headers.X-Stash-Selected-Proxy",encodeURI(e.policy)),$done(e);break;case"Egern":case"Shadowrocket":default:$done(e);break;case"Quantumult X":e.policy&&t.set(e,"opts.policy",e.policy),delete e.charset,delete e.host,delete e.method,delete e.opt,delete e.path,delete e.policy,delete e.scheme,delete e.sessionIndex,delete e.statusCode,e.body instanceof ArrayBuffer?(e.bodyBytes=e.body,delete e.body):ArrayBuffer.isView(e.body)?(e.bodyBytes=e.body.buffer.slice(e.body.byteOffset,e.body.byteLength+e.body.byteOffset),delete e.body):e.body&&delete e.bodyBytes,$done(e);break;case"Node.js":process.exit(1)}}}var a={Switch:!0},o={Storefront:[["AE","143481"],["AF","143610"],["AG","143540"],["AI","143538"],["AL","143575"],["AM","143524"],["AO","143564"],["AR","143505"],["AT","143445"],["AU","143460"],["AZ","143568"],["BA","143612"],["BB","143541"],["BD","143490"],["BE","143446"],["BF","143578"],["BG","143526"],["BH","143559"],["BJ","143576"],["BM","143542"],["BN","143560"],["BO","143556"],["BR","143503"],["BS","143539"],["BT","143577"],["BW","143525"],["BY","143565"],["BZ","143555"],["CA","143455"],["CD","143613"],["CG","143582"],["CH","143459"],["CI","143527"],["CL","143483"],["CM","143574"],["CN","143465"],["CO","143501"],["CR","143495"],["CV","143580"],["CY","143557"],["CZ","143489"],["DE","143443"],["DK","143458"],["DM","143545"],["DO","143508"],["DZ","143563"],["EC","143509"],["EE","143518"],["EG","143516"],["ES","143454"],["FI","143447"],["FJ","143583"],["FM","143591"],["FR","143442"],["GA","143614"],["GB","143444"],["GD","143546"],["GF","143615"],["GH","143573"],["GM","143584"],["GR","143448"],["GT","143504"],["GW","143585"],["GY","143553"],["HK","143463"],["HN","143510"],["HR","143494"],["HU","143482"],["ID","143476"],["IE","143449"],["IL","143491"],["IN","143467"],["IQ","143617"],["IS","143558"],["IT","143450"],["JM","143511"],["JO","143528"],["JP","143462"],["KE","143529"],["KG","143586"],["KH","143579"],["KN","143548"],["KP","143466"],["KR","143466"],["KW","143493"],["KY","143544"],["KZ","143517"],["TC","143552"],["TD","143581"],["TJ","143603"],["TH","143475"],["TM","143604"],["TN","143536"],["TO","143608"],["TR","143480"],["TT","143551"],["TW","143470"],["TZ","143572"],["LA","143587"],["LB","143497"],["LC","143549"],["LI","143522"],["LK","143486"],["LR","143588"],["LT","143520"],["LU","143451"],["LV","143519"],["LY","143567"],["MA","143620"],["MD","143523"],["ME","143619"],["MG","143531"],["MK","143530"],["ML","143532"],["MM","143570"],["MN","143592"],["MO","143515"],["MR","143590"],["MS","143547"],["MT","143521"],["MU","143533"],["MV","143488"],["MW","143589"],["MX","143468"],["MY","143473"],["MZ","143593"],["NA","143594"],["NE","143534"],["NG","143561"],["NI","143512"],["NL","143452"],["NO","143457"],["NP","143484"],["NR","143606"],["NZ","143461"],["OM","143562"],["PA","143485"],["PE","143507"],["PG","143597"],["PH","143474"],["PK","143477"],["PL","143478"],["PT","143453"],["PW","143595"],["PY","143513"],["QA","143498"],["RO","143487"],["RS","143500"],["RU","143469"],["RW","143621"],["SA","143479"],["SB","143601"],["SC","143599"],["SE","143456"],["SG","143464"],["SI","143499"],["SK","143496"],["SL","143600"],["SN","143535"],["SR","143554"],["ST","143598"],["SV","143506"],["SZ","143602"],["UA","143492"],["UG","143537"],["US","143441"],["UY","143514"],["UZ","143566"],["VC","143550"],["VE","143502"],["VG","143543"],["VN","143471"],["VU","143609"],["XK","143624"],["YE","143571"],["ZA","143472"],["ZM","143622"],["ZW","143605"]]},i={Settings:a,Configs:o},n={Switch:!0,PEP:{GCC:"US"},Services:{PlaceData:"CN",Directions:"AUTO",Traffic:"AUTO",RAP:"XX",Tiles:"AUTO"},Geo_manifest:{Dynamic:{Config:{Country_code:{default:"AUTO",iOS:"CN",iPadOS:"CN",watchOS:"US",macOS:"CN"}}}},Config:{Announcements:{"Environment:":{default:"AUTO",iOS:"CN",iPadOS:"CN",watchOS:"XX",macOS:"CN"}},Defaults:{LagunaBeach:!0,DrivingMultiWaypointRoutesEnabled:!0,GEOAddressCorrection:!0,LookupMaxParametersCount:!0,LocalitiesAndLandmarks:!0,POIBusyness:!0,PedestrianAR:!0,"6694982d2b14e95815e44e970235e230":!0,OpticalHeading:!0,UseCLPedestrianMapMatchedLocations:!0,TransitPayEnabled:!0,SupportsOffline:!0,SupportsCarIntegration:!0,WiFiQualityNetworkDisabled:!1,WiFiQualityTileDisabled:!1}}},r={Settings:n},c={Switch:!0,CountryCode:"US",newsPlusUser:!0},l={Settings:c},h={Switch:!0,CountryCode:"US",canUse:!0},u={Settings:h},p={Switch:!0,CountryCode:"SG",Domains:["web","itunes","app_store","movies","restaurants","maps"],Functions:["flightutilities","lookup","mail","messages","news","safari","siri","spotlight","visualintelligence"],Safari_Smart_History:!0},d={VisualIntelligence:{enabled_domains:["pets","media","books","art","nature","landmarks"],supported_domains:["ART","BOOK","MEDIA","LANDMARK","ANIMALS","BIRDS","FOOD","SIGN_SYMBOL","AUTO_SYMBOL","DOGS","NATURE","NATURAL_LANDMARK","INSECTS","REPTILES","ALBUM","STOREFRONT","LAUNDRY_CARE_SYMBOL","CATS","OBJECT_2D","SCULPTURE","SKYLINE","MAMMALS"]}},g={Settings:p,Configs:d},y={Switch:"true",CountryCode:"US",MultiAccount:"false",Universal:"true"},m={Settings:y},f={Switch:!0,"Third-Party":!1,HLSUrl:"play-edge.itunes.apple.com",ServerUrl:"play.itunes.apple.com",Tabs:["WatchNow","Originals","MLS","Sports","Kids","Store","Movies","TV","ChannelsAndApps","Library","Search"],CountryCode:{Configs:"AUTO",Settings:"AUTO",View:["SG","TW"],WatchNow:"AUTO",Channels:"AUTO",Originals:"AUTO",Sports:"US",Kids:"US",Store:"AUTO",Movies:"AUTO",TV:"AUTO",Persons:"SG",Search:"AUTO",Others:"AUTO"}},S={Locale:[["AU","en-AU"],["CA","en-CA"],["GB","en-GB"],["KR","ko-KR"],["HK","yue-Hant"],["JP","ja-JP"],["MO","zh-Hant"],["TW","zh-Hant"],["US","en-US"],["SG","zh-Hans"]],Tabs:[{title:"主页",type:"WatchNow",universalLinks:["https://tv.apple.com/watch-now","https://tv.apple.com/home"],destinationType:"Target",target:{id:"tahoma_watchnow",type:"Root",url:"https://tv.apple.com/watch-now"},isSelected:!0},{title:"Apple TV+",type:"Originals",universalLinks:["https://tv.apple.com/channel/tvs.sbd.4000","https://tv.apple.com/atv"],destinationType:"Target",target:{id:"tvs.sbd.4000",type:"Brand",url:"https://tv.apple.com/us/channel/tvs.sbd.4000"}},{title:"MLS Season Pass",type:"MLS",universalLinks:["https://tv.apple.com/mls"],destinationType:"Target",target:{id:"tvs.sbd.7000",type:"Brand",url:"https://tv.apple.com/us/channel/tvs.sbd.7000"}},{title:"体育节目",type:"Sports",universalLinks:["https://tv.apple.com/sports"],destinationType:"Target",target:{id:"tahoma_sports",type:"Root",url:"https://tv.apple.com/sports"}},{title:"儿童",type:"Kids",universalLinks:["https://tv.apple.com/kids"],destinationType:"Target",target:{id:"tahoma_kids",type:"Root",url:"https://tv.apple.com/kids"}},{title:"电影",type:"Movies",universalLinks:["https://tv.apple.com/movies"],destinationType:"Target",target:{id:"tahoma_movies",type:"Root",url:"https://tv.apple.com/movies"}},{title:"电视节目",type:"TV",universalLinks:["https://tv.apple.com/tv-shows"],destinationType:"Target",target:{id:"tahoma_tvshows",type:"Root",url:"https://tv.apple.com/tv-shows"}},{title:"商店",type:"Store",universalLinks:["https://tv.apple.com/store"],destinationType:"SubTabs",subTabs:[{title:"电影",type:"Movies",universalLinks:["https://tv.apple.com/movies"],destinationType:"Target",target:{id:"tahoma_movies",type:"Root",url:"https://tv.apple.com/movies"}},{title:"电视节目",type:"TV",universalLinks:["https://tv.apple.com/tv-shows"],destinationType:"Target",target:{id:"tahoma_tvshows",type:"Root",url:"https://tv.apple.com/tv-shows"}}]},{title:"频道和 App",destinationType:"SubTabs",subTabsPlacementType:"ExpandedList",type:"ChannelsAndApps",subTabs:[]},{title:"资料库",type:"Library",destinationType:"Client"},{title:"搜索",type:"Search",universalLinks:["https://tv.apple.com/search"],destinationType:"Target",target:{id:"tahoma_search",type:"Root",url:"https://tv.apple.com/search"}}],i18n:{WatchNow:[["en","Home"],["zh","主页"],["zh-Hans","主頁"],["zh-Hant","主頁"]],Movies:[["en","Movies"],["zh","电影"],["zh-Hans","电影"],["zh-Hant","電影"]],TV:[["en","TV"],["zh","电视节目"],["zh-Hans","电视节目"],["zh-Hant","電視節目"]],Store:[["en","Store"],["zh","商店"],["zh-Hans","商店"],["zh-Hant","商店"]],Sports:[["en","Sports"],["zh","体育节目"],["zh-Hans","体育节目"],["zh-Hant","體育節目"]],Kids:[["en","Kids"],["zh","儿童"],["zh-Hans","儿童"],["zh-Hant","兒童"]],Library:[["en","Library"],["zh","资料库"],["zh-Hans","资料库"],["zh-Hant","資料庫"]],Search:[["en","Search"],["zh","搜索"],["zh-Hans","搜索"],["zh-Hant","蒐索"]]}},b={Settings:f,Configs:S},v=Database={Default:Object.freeze({__proto__:null,Configs:o,Settings:a,default:i}),Location:Object.freeze({__proto__:null,Settings:n,default:r}),News:Object.freeze({__proto__:null,Settings:c,default:l}),PrivateRelay:Object.freeze({__proto__:null,Settings:h,default:u}),Siri:Object.freeze({__proto__:null,Configs:d,Settings:p,default:g}),TestFlight:Object.freeze({__proto__:null,Settings:y,default:m}),TV:Object.freeze({__proto__:null,Configs:S,Settings:f,default:b})};function T(s,a,o){console.log("☑️ Set Environment Variables","");let{Settings:i,Caches:n,Configs:r}=function(s,a,o){let i=e.getItem(s,o),n={};if("undefined"!=typeof $argument&&Boolean($argument)){let e=Object.fromEntries($argument.split("&").map((t=>t.split("=").map((t=>t.replace(/\"/g,""))))));for(let s in e)t.set(n,s,e[s])}const r={Settings:o?.Default?.Settings||{},Configs:o?.Default?.Configs||{},Caches:{}};Array.isArray(a)||(a=[a]);for(let t of a)r.Settings={...r.Settings,...o?.[t]?.Settings,...n,...i?.[t]?.Settings},r.Configs={...r.Configs,...o?.[t]?.Configs},i?.[t]?.Caches&&"string"==typeof i?.[t]?.Caches&&(i[t].Caches=JSON.parse(i?.[t]?.Caches)),r.Caches={...r.Caches,...i?.[t]?.Caches};return function t(e,s){for(var a in e){var o=e[a];e[a]="object"==typeof o&&null!==o?t(o,s):s(a,o)}return e}(r.Settings,((t,e)=>("true"===e||"false"===e?e=JSON.parse(e):"string"==typeof e&&(e=e.includes(",")?e.split(",").map((t=>c(t))):c(e)),e))),r;function c(t){return t&&!isNaN(t)&&(t=parseInt(t,10)),t}}(s,a,o);if(i?.Tabs&&!Array.isArray(i?.Tabs)&&t.set(i,"Tabs",i?.Tabs?[i.Tabs.toString()]:[]),i?.Domains&&!Array.isArray(i?.Domains)&&t.set(i,"Domains",i?.Domains?[i.Domains.toString()]:[]),i?.Functions&&!Array.isArray(i?.Functions)&&t.set(i,"Functions",i?.Functions?[i.Functions.toString()]:[]),console.log(`✅ Set Environment Variables, Settings: ${typeof i}, Settings内容: ${JSON.stringify(i)}`,""),r.Storefront=new Map(r.Storefront),r.Locale&&(r.Locale=new Map(r.Locale)),r.i18n)for(let t in r.i18n)r.i18n[t]=new Map(r.i18n[t]);return{Settings:i,Caches:n,Configs:r}}const w=new s(" iRingo: ☁️ iCloud Private Relay v1.0.4(2) response"),C=class{static name="URI";static version="1.2.7";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static#o={scheme:"",host:"",path:"",query:{}};static parse(t){let e=t.match(/(?:(?<scheme>.+):\/\/(?<host>[^/]+))?\/?(?<path>[^?]+)?\??(?<query>[^?]+)?/)?.groups??null;if(e?.path?e.paths=e.path.split("/"):e.path="",e?.paths){const t=e.paths[e.paths.length-1];if(t?.includes(".")){const s=t.split(".");e.format=s[s.length-1]}}return e?.query&&(e.query=Object.fromEntries(e.query.split("&").map((t=>t.split("="))))),e}static stringify(t=this.#o){let e="";return t?.scheme&&t?.host&&(e+=t.scheme+"://"+t.host),t?.path&&(e+=t?.host?"/"+t.path:t.path),t?.query&&(e+="?"+Object.entries(t.query).map((t=>t.join("="))).join("&")),e}}.parse($request.url);w.log(`⚠ URL: ${JSON.stringify(C)}`,"");const k=$request.method;C.host;const A=C.path;C.paths,w.log(`⚠ METHOD: ${k}`,"");const L=($response.headers?.["Content-Type"]??$response.headers?.["content-type"])?.split(";")?.[0];w.log(`⚠ FORMAT: ${L}`,""),(async()=>{const{Settings:t,Caches:e={},Configs:s}=T("iRingo","PrivateRelay",v);switch(t.Switch){case!0:default:if("v1/fetchAuthTokens"===A);else/\/accounts\//i.test(A)?(w.log("🚧 accounts",""),/\/subscriptions\/features/i.test(A)&&(w.log("🚧 /subscriptions/features",""),$request.headers["X-MMe-Country"]=t.CountryCode,/\/features$/i.test(A)?w.log("🚧 /features",""):/\/networking\.privacy\.subscriber$/i.test(A)?w.log("🚧 /networking.privacy.subscriber",""):/\/networking\.privacy\.attestation$/i.test(A)?w.log("🚧 /networking.privacy.attestation",""):/\/mail\.hide-my-email\.create$/i.test(A)?w.log("🚧 /mail.hide-my-email.create",""):/\/mail\.custom-domains\.transfer$/i.test(A)?w.log("🚧 /mail.custom-domains.transfer",""):w.log("🚧 unknown",""))):/\/devices\//i.test(A)&&(w.log("🚧 devices",""),/\/subscriptions\/features/i.test(A)&&(w.log("🚧 /subscriptions/features",""),$request.headers["X-MMe-Country"]=t.CountryCode,/\/features$/i.test(A)?w.log("🚧 /features",""):/\/networking\.privacy\.subscriber$/i.test(A)?w.log("🚧 /networking.privacy.subscriber",""):/\/networking\.privacy\.attestation$/i.test(A)?w.log("🚧 /networking.privacy.attestation",""):/\/mail\.hide-my-email\.create$/i.test(A)?w.log("🚧 /mail.hide-my-email.create",""):/\/mail\.custom-domains\.transfer$/i.test(A)?w.log("🚧 /mail.custom-domains.transfer",""):w.log("🚧 unknown","")));w.log("🚧 Private Relay",`$response.body = ${$response.body}`,"");case!1:}})().catch((t=>w.logErr(t))).finally((()=>w.done($response)));
